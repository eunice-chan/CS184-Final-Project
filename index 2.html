<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
    body {
        width: 70%;
        margin: 15%;
        text-align: left;
        font-weight: 300;
        font-family: 'Open Sans', sans-serif;
        color: #121212;
    }

    h1, h2, h3, h4 {
        font-family: 'Source Sans Pro', sans-serif;
    }

    pre {
        padding: 15px;
        overflow: auto;
        line-height: 1.45;
        background-color: #f6f6f6;
        border-radius: 3px;
    }

    code {
        background-color: #dddddd;
        padding: 2px 5px 2px 5px;
        border-radius: 5px;
    }

    table {
        border-collapse: collapse;
    }

    td, th {
        border: 1px solid #bbbbbb;
        text-align: left;
        padding: 8px;
    }

    .dark {
        background-color: #dddddd;
    }
    .light {
        background-color: #f6f6f6;
    }
    .white {
        background-color: #ffffff;
    }
</style>
<title>CS 184 Cloth Sim</title>
<link rel="icon" href="penrosetriangle.svg">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>
<body>
<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2020</h1>
<h1 align="middle">Project 4: Cloth Sim</h1>
<h2 align="middle">EUNICE CHAN</h2>

<br />

<div align="middle">
    <img
            src="https://drive.google.com/uc?id=1DZQwwl_aq1IEPGaZFk4bAYzEJNrqHRN4"
            alt="Project image"
            width=1000px">
</div>

<br />

<h2 align="middle">Overview</h2>
<!--
An overview of the project, your approach to the various parts,
what problems you encountered and how you solved them. Strive
for clarity and succinctness.
-->


<h2 align="middle">Part 1: Masses and Springs</h2>
<p>
    I modeled the cloth as a grid of masses connected by springs. The image shows
    the wireframe. There are three types of structures: one for the structure of
    the cloth, one so that the cloth will resist shearing, and one so that the cloth
    will resist out-of-plane bending.
</p>

<figure align="middle">
    <img src="images/full_wireframe.png" width="480px" />
    <figcaption align="middle">
        This is the full wireframe with the structure for
        structure, shearing, and bending.
    </figcaption>
</figure>

<figure align="middle">
    <img src="images/shear_wireframe.png" width="480px" />
    <figcaption align="middle">
        This is the structure to resist shearing. Because of
        the cross, it doesn't have as much of a bias
        (especially when compared to just one diagonal).
    </figcaption>
</figure>
<figure align="middle">
    <img src="images/no_shear_wireframe.png" width="480px" />
    <figcaption align="middle">
        This is the structure that provides the shape of the
        cloth. Although it is not visible, each mass is also
        connected to the mass two above, below, left, and right
        with weaker springs. This is to resist out-of-plane
        shearing.
    </figcaption>
</figure>


<h2 align="middle">Part 2: Simulation via Numerical Integration</h2>
<p>
    Next, I modeled the physics acting on the cloth. To compute the
    total amount of force acting on the cloth, I summed up all
    the external forces (using F = ma with external acceleration such
    as gravity) and added it to the spring correction forces. I then
    use Verlet integration to compute the new point mass positions.
    To prevent the springs from being unreasonably deformed, I added
    constraints as described in this
    <a href="https://www.cs.rpi.edu/~cutler/classes/advancedgraphics/S14/papers/provot_cloth_simulation_96.pdf">
        SIGGRAPH 1995 Provot paper
    </a> to ensure the spring's length is never more than 10% of the
    rest length at the end of any timestep.
</p>
<figure align="middle">
    <img src="images/pinned_physics.png" width="900px" />
    <figcaption align="middle">
        Cloth affected by physics.
    </figcaption>
</figure>
<p>
    While running the experiment with different parameters, I was able to observe the effect of each parameters.
</p>
<table align="middle">
    <h3 align="middle">Varying <code>ks</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/cloth_ks_500.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 500.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_ks_5000.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with default ks = 5000.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_ks_50000.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 50000.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    The spring constant <code>ks</code> represents the stiffness of the cloth. When the value is very high (ks = 100000), the
    cloth is very stiff and did not move around as much. When it was very low, (ks=1), the cloth is much stretchier. With a low
    <code>ks</code> value, the cloth is more wrinkly/saggy and there was a lot more wiggle and rippling of the cloth.
</p>
<table align="middle">
    <h3 align="middle">Varying <code>density</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/cloth_density_1.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with density = 1.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_ks_5000.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with default density = 15.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_density_150.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with density = 150.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    The <code>density</code> parameter is used in mass and is proportional to the mass. A higher mass means a higher force.
    Therefore, when the density parameter is higher, the cloth seems heavier with a lot of force pulling down while the
    lower density value gives the appearance of a lighter cloth.
</p>
<table align="middle">
    <h3 align="middle">Varying <code>damping</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/cloth_damping_05.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with damping at approximately 0.05.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_ks_5000.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with default damping = 0.2.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/cloth_damping_9.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with damping at approximately 0.9.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    The <code>damping</code> parameter that affects the decay of the spring oscillation. With a low damping value, there
    is less of a loss of energy, resulting in a bouncy fabric. Meanwhile with a high damping, there's much less energy/
    much more loss of energy and thus there is less bounce and the fabric becomes still much faster.
</p>

<h2 align="middle">Part 3: Handling Collisions with Other Objects</h2>
<p>
    In this part I handle collisions with other objects. Specifically, a sphere
    and a plane. To do so, I check if the point will intersect or be inside the
    sphere, or if it goes through the plane, then adjust the point so that it is
    just on top of the sphere or plane.
</p>
<figure align="middle">
    <img src="images/cloth_plane.png" width="900px" />
    <figcaption align="middle">
        Cloth-plane collision.
    </figcaption>
</figure>
<table align="middle">
    <h3 align="middle">Varying <code>ks</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/sphere_ks_500.png" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 500.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/sphere_ks_5000.png" width="250px" />
                <figcaption align="middle">
                    Cloth with default ks = 5000.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/sphere_ks_50000.png" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 50000.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    Here, the cloth is falls onto the sphere. The different <code>ks</code> values
    affect how the cloth lies on the sphere. With low <code>ks</code> values, the
    cloth is more relaxed and has more folds. With a high value for <code>ks</code>,
    the cloth tries to maintain it's shape more and is much less pliable. As a result,
    it does not outline the shape of the sphere as well.
</p>

<h2 align="middle">Part 4: Handling Self-collisions</h2>
<p>
    I handled self-collisions. Since it would take too long to check for a collision with
    every point in the cloth, I implemented spatial hashing. I divided the space into 3D
    boxes and only check for collisions (points are within a certain distance of each other)
    among the points in the same box.
</p>
<table align="middle">
    <h3 align="middle">Cloth Falling and Folding</h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/self_1.png" width="250px" />
                <figcaption align="middle">
                    Cloth starts to fall. The bottom collides with the plane.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_2.png" width="250px" />
                <figcaption align="middle">
                    Halfway through falling. Cloth folds upon itself.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_3.png" width="250px" />
                <figcaption align="middle">
                    No clipping of the cloth!
                </figcaption>
            </figure>
        </td>
    </tr>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/self_4.png" width="250px" />
                <figcaption align="middle">
                    Cloth starts to slide to flatten itself due to point mass repelling each other.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_5.png" width="250px" />
                <figcaption align="middle">
                    Continuing to slide but still no clipping of the cloth.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_6.png" width="250px" />
                <figcaption align="middle">
                    Point masses repel each other due to lack of damping spring forces.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>

<table align="middle">
    <h3 align="middle">Varying <code>ks</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/self_ks_500.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 500.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_default.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with default ks = 5000.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_ks_50000.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with ks = 50000.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    As established before, <code>ks</code> represents the "stiffness" of the cloth. We can see how
    this property of the cloth comes into play as it affects the way the cloth folds over itself.
    At low values of <code>ks</code>, the cloth is much more springy and as a result, it has much
    more motion and folds over itself many times over. At high values of <code>ks</code>, however,
    the cloth is much less springy and tends to preserve its shape. As a result, it does not fold
    as often and moves slowly as it is much closer to settled when it lands on the ground than the
    springy cloth of low <code>ks</code>.
</p>
<table align="middle">
    <h3 align="middle">Varying <code>density</code></h3>
    <tr>
        <td>
            <figure align="middle">
                <img src="images/self_density_1.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with density = 1.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_default.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with default density = 15.
                </figcaption>
            </figure>
        </td>
        <td>
            <figure align="middle">
                <img src="images/self_density_150.gif" width="250px" />
                <figcaption align="middle">
                    Cloth with density = 150.
                </figcaption>
            </figure>
        </td>
    </tr>
</table>
<p>
    One thing I immediately notice is that with a lower <code>density</code>, the wrinkles propagates up the cloth
    much faster. While falling down, the wrinkles of the low <code>density</code> cloth almost immediately climbs
    up to the cloth. However, for the high <code>density</code> cloth, this is not the case, and the wrinkles stay
    relatively localized at ground-level. This is due to the fact the force is higher and thus when the wrinkles form,
    it's pulled down faster and thus the wrinkles are more "compressed" unlike the low <code>density</code> cloth.
</p>

<h2 align="middle">Part 5: Shaders</h2>
<p>
    I implemented different shaders! The ones implemented for this project are: Diffuse, Blinn-Phong, Texture Mapping,
    Bump & Displacement Map, and Mirror shaders.
</p>

<figure align="middle">
    <img src="images/diffuse_shader.png" width="900px" />
    <figcaption align="middle">
        <b>Diffuse Shader</b> <br />
        The lighting depends only on the angle between the surface and the light source.
    </figcaption>
</figure>

<figure align="middle">
    <img src="images/bp_shader.png" width="900px" />
    <figcaption align="middle">
        <b>Blinn-Phong Shader</b> <br />
        Ambient + Diffuse + Specular (set <code>ks=50000</code> to show off highlights more).
    </figcaption>
</figure>

<figure align="middle">
    <img src="images/tm_shader.png" width="900px" />
    <figcaption align="middle">
        <b>Texture Mapping shader</b> <br />
        Map texture onto cloth.
    </figcaption>
</figure>

<figure align="middle">
    <img src="images/bump_shader.png" width="900px" />
    <figcaption align="middle">
        <b>Bump & Displacement Mapping Shader</b> <br />
        Encode a height map in a texture and use it to modify the texturing detail of the cloth.
    </figcaption>
</figure>

<figure align="middle">
    <img src="images/mirror_shader.png" width="900px" />
    <figcaption align="middle">
        <b>Mirror Shader</b> <br />
        Mirror an environment map.
    </figcaption>
</figure>

<h3 align="middle">Custom Shader: Lo-fi Shader</h3>
<p>
    I was initially inspired by a mistake I made in which I accidentally set the positions
    of the displacement vertices wrong and ended up with a looming, monochromatic, spiky
    planet. I really liked how it looked and inspired by that, I decided to start off with
    a toon shader. I copied over the code for the diffuse shader, then rounded the values
    by <code>floor(color * toon_cutoff)</code>. This caused the image to have hard shadows
    rather than soft.
</p>
<figure align="middle">
    <img src="images/darkness.png" width="900px" />
    <figcaption>My mistake turned inspiration.</figcaption>
</figure>
<figure align="middle">
    <img src="images/toon_shading.png" width="900px" />
</figure>
<p>
    Next, I realized I didn't ever use the color picker, so I decided to set the color with the color picker.
</p>
<figure align="middle">
    <img src="images/colors.gif" width="900px" />
</figure>
<p>
    I thought just having a solid color was kind of boring, so I used the complementary color for
    the shadows (<code>1 - u_color</code>). To do so, I created the pair, then I converted
    everything to HSV, then I set the saturation to and multiplied the value with the calculated HSV
    values, and set the hue to either the chosen color or the complementary color, depending on a
    cutoff darkness value.
</p>
<figure align="middle">
    <img src="images/complementary.gif" width="900px" />
</figure>
<p>
    As an aside: initially, when I was experimenting, I had used the HSV values directly because I liked
    how it looked and it was more straightforward than calculating the associated HSV. However,
    the color picker was less intuitively correlated with the shader color than I would've
    liked, so I converted it to HSV and calculated colors with that. As a result, the color
    combinations are a bit different. In the end, I liked both versions.
</p>
<figure align="middle">
    <img src="images/rgb.png" width="900px" />
    <figcaption>Calculated with HSV.</figcaption>
</figure>

<figure align="middle">
    <img src="images/rgb_height.png" width="900px" />
    <figcaption>Modified the height parameter so the displacement is extreme.</figcaption>
</figure>
<p>
    After I added a complementary color, I added the normal, Blinn-Phong, mirror, and
    bump/displacement (using texture 4 this time!) shader code in and interpolated that.
    I also adjusted the alpha so it's semi-transparent. While doing that, I decided that
    just two colors looks too strange, so I added a third color which is a linear
    interpolation with this code:
    <pre>
  if (toon[2] > k_t) {
    toon[0] = in_color[0];
    // Saturation
    toon[1] = in_color[1];
    // Value
    toon[2] *= in_color[2];
  } else if (toon[2] < k_b) {
    toon[0] = in_color_pair[0];
    // Saturation
    toon[1] = in_color[1];
    // Value
    toon[2] *= 0.8*in_color[2];
  } else {
    toon[0] = k_t * in_color[0] + (1 - k_t) * in_color_pair[0];
    // Saturation
    toon[1] = in_color[1];
    // Value
    toon[2] *= in_color[2];
  }
    </pre>
</p>
<p>
    Here's the final result!
</p>

<figure align="middle">
    <img src="images/hsv.png" width="900px" />
    <figcaption>Lo-fi shader</figcaption>
</figure>

<figure align="middle">
    <img src="images/textured_hsv.png" width="900px" />
    <figcaption>With visible modified normals.</figcaption>
</figure>

<figure align="middle">
    <img src="images/displacement_hsv.png" width="900px" />
    <figcaption>With displacement shader affecting vertex positions.</figcaption>
</figure>

<figure align="middle">
    <img src="images/hsv.gif" width="900px" />
</figure>
</body>
</html>




